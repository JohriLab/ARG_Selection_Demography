#!/bin/bash
#SBATCH --mail-user=jimarsh@unc.edu
#SBATCH --mail-type=ALL
#SBATCH -p general
#SBATCH -N 1
#SBATCH -t 00-24:00:00
#SBATCH --mem=20g
#SBATCH -a 1-10%10
#SBATCH -n 15
#SBATCH -o /nas/longleaf/home/jimarsh/LOGFILES/array_test.o
#SBATCH -e /nas/longleaf/home/jimarsh/LOGFILES/array_test.e

echo "SLURM_JOBID: " $SLURM_JOBID
echo "SLURM_ARRAY_TASK_ID: " $SLURM_ARRAY_TASK_ID
echo "SLURM_ARRAY_JOB_ID: " $SLURM_ARRAY_JOB_ID

declare -i startID=0

declare -i repID=${startID}+$SLURM_ARRAY_TASK_ID

cd /work/users/j/i/jimarsh/basic_sims/SLiM

module load slim
module load gcc
module load r

slim -d d_scale=100 -d d_N=20000 -d d_burnin=15 -d d_nSamples=10 -d d_repID=${repID} -d "d_folder='slim_out'" /work/users/j/i/jimarsh/git/ARG_BGS/baseline/replicates_50Mb.slim

cd relate_out

/work/users/j/i/jimarsh/relate_v1.1.9_x86_64_dynamic/bin/RelateFileFormats --mode ConvertFromVcf --haps test_R${repID}.haps --sample test_R${repID}.sample -i ../slim_out/N10_R${repID}

/work/users/j/i/jimarsh/relate_v1.1.9_x86_64_dynamic/bin/Relate --mode All -m 1.25e-8 -N 40000 --haps test_R${repID}.haps --sample test_R${repID}.sample --map test.map --seed 1 -o test_${repID}

/work/users/j/i/jimarsh/relate_v1.1.9_x86_64_dynamic/scripts/EstimatePopulationSize/EstimatePopulationSize.sh \
              -i test_${repID} \
              -m 1.25e-8 \
              --poplabels test.poplabels \
              --seed 1 \
              -o test_${repID}_popsize
